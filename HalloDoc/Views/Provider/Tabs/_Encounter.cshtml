@using DataAccess.ViewModel;
@model AdminDashboard
<link rel="stylesheet" href="~/css/AdminSite.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
@{
    ViewData["Title"] = "Encounter Page";
}
<style>
    .iti {
        width: 100%;
    }

    #phone, #phone1 {
        height: 58px;
    }
</style>
<div class="container ">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between mt-3 mb-3">
                <h4 class="mt-3">Encounter Form</h4>
                <button type="button" class="hoverbtn btn btn-outline-info p-2 pe-3 bi bi-chevron-left backbtn">
                    Back
                </button>
            </div>
            <form method="post" id="enable" class="dark-mode1 EncounterForm">
                <div class="container rounded  shadow py-3">
                    <h3 class="mb-3 text-center "><strong class="text-info">Medical Report-Confidential</strong></h3>
                    <div class="row">
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input name="first_name" asp-for="@Model.encounterform.FirstName" type="text" class="form-control shadow-none" id="exampleFormControlInput1" placeholder="Firstname" disabled required />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Firstname</label>
                            <div class="invalid-feedback">Please provide a Firstname.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input name="last_name" type="text" asp-for="@Model.encounterform.LastName" class=" form-control" id="exampleFormControlInput1" placeholder="Lastname" disabled required />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Lastname</label>
                            <div class="invalid-feedback">Please provide a Lastname.</div>
                        </div>
                        <div class="col-12 form-floating mb-3 text-muted">
                            <input name="Location" type="text" class="form-control" asp-for="@Model.encounterform.Address" id=" exampleFormControlInput1" placeholder="Location" disabled required />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Location</label>
                            <div class="invalid-feedback">Please provide a Location.</div>

                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input type="date" class="form-control" id="dob" asp-for="@Model.encounterform.BirthDate" placeholder="Date Of Birth" disabled required />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Date Of Birth</label>
                            <div class="invalid-feedback">Please provide a Date Of Birth.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input type="date" name="Date" class="form-control" id="Date" placeholder="Date" disabled required />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Date</label>
                            <div class="invalid-feedback">Please provide a Date.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input id="phone" class="form-control inp2 " asp-for="@Model.encounterform.Number" type="tel" placeholder="Phone Number" disabled required />
                            <div class="invalid-feedback">Please provide a PhoneNumber.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input name="email" type="email" class="form-control" asp-for="@Model.encounterform.Email" id="email" placeholder="Email" disabled required />
                            <label for="email" class="form-label ps-4 text-secondary">Email</label>
                            <div class="invalid-feedback">Please provide a Email.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" asp-for="@Model.encounterform.HistoryOfPresentIllness" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">History Of present illness or Injury</label>
                            <div class="invalid-feedback">Please provide a History Of present illness or Injury.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" asp-for="@Model.encounterform.MedicalHistory" id="floatingTextarea2" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Medical History</label>
                            <div class="invalid-feedback">Please provide a Medical History.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" asp-for="@Model.encounterform.Medications" id="floatingTextarea2" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Medications</label>
                            <div class="invalid-feedback">Please provide a Medications.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" asp-for="@Model.encounterform.Allergies" id="floatingTextarea2" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Allergies</label>
                            <div class="invalid-feedback">Please provide a Allergies.</div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-4 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" asp-for="@Model.encounterform.Temperature" placeholder="Temp" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Temp</label>
                            <div class="invalid-feedback">Please provide a Temp.</div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-4 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" asp-for="@Model.encounterform.HR" placeholder="HR" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">HR</label>
                            <div class="invalid-feedback">Please provide a HR.</div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" asp-for="@Model.encounterform.RR" placeholder="RR" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">RR</label>
                            <div class="invalid-feedback">Please provide a RR.</div>
                        </div>

                        <div class="col-sm-6 col-md-2 col-xl-2 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" placeholder="FirsBlood pressuretname" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Blood pressure</label>
                            <div class="invalid-feedback">Please provide a Blood pressure.</div>
                        </div>
                        <div class="col-sm-6 col-md-2 col-xl-2 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" placeholder="Blood pressure" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Blood pressure</label>
                            <div class="invalid-feedback">Please provide a Blood pressure.</div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" placeholder="O2" asp-for="@Model.encounterform.O2" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">O2</label>
                            <div class="invalid-feedback">Please provide a O2.</div>
                        </div>
                        <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                            <input type="text" class="form-control input shadow-none" id="exampleFormControlInput1" placeholder="Pain" asp-for="@Model.encounterform.Pain" disabled />
                            <label for="exampleFormControlInput1" class="form-label ps-4 text-secondary">Pain</label>
                            <div class="invalid-feedback">Please provide a Pain.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6  form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Heent" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Heent</label>
                            <div class="invalid-feedback">Please provide a Heent.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.CV" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">CV</label>
                            <div class="invalid-feedback">Please provide a CV.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Chest" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Chest</label>
                            <div class="invalid-feedback">Please provide a Chest.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.ABD" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">ABD</label>
                            <div class="invalid-feedback">Please provide a ABD.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input  shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Extr" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Extr</label>
                            <div class="invalid-feedback">Please provide a Extr.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Skin" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Skin</label>
                            <div class="invalid-feedback">Please provide a Skin.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Neuro" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Neuro</label>
                            <div class="invalid-feedback">Please provide a Neuro.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Other" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Other</label>
                            <div class="invalid-feedback">Please provide a Other.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input  shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Diagnosis" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Diagnosis</label>
                            <div class="invalid-feedback">Please provide a Diagnosis.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                            <input class="form-control input  shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.TreatmentPlan" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Treatment Plan</label>
                            <div class="invalid-feedback">Please provide a Treatment Plan.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.MedicationDispensed" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Medications Dispensed</label>
                            <div class="invalid-feedback">Please provide a Medications Dispensed.</div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.Procedures" disabled>
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Procedures</label>
                            <div class="invalid-feedback">Please provide a Procedures.</div>
                        </div>
                        <div class="form-floating mb-3 text-muted">
                            <input class="form-control input shadow-none" placeholder="Leave a comment here" id="floatingTextarea2" asp-for="@Model.encounterform.FollowUp" disabled />
                            <label for="floatingTextarea2" class="ps-4 text-secondary">Followup</label>
                            <div class="invalid-feedback">Please provide a Followup.</div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end g-2 ">
                        <div>
                            @if (Model.encounterform.IsFinalize == true)
                            {
                                <button type="button" id="edit" class="btn text-white px-4 p-2 bg-info me-2" onclick="EditBtn()" disabled>Edit</button>
                            }
                            else
                            {
                                <button type="button" id="edit" class="btn text-white px-4 p-2 bg-info me-2" onclick=" EditBtn()">Edit</button>
                            }
                        </div>
                        <input asp-for="@Model.encounterform.Requestid" value="@Model.requestid" hidden />
                        <div id="editbtnz" style="display: none">
                            <button type="submit" class="btn text-white px-4 p-2 bg-info savechanges" data-value1="_Encounter">Save Changes</button>

                        </div>
                        <div class="text-end pb-3">
                            <button type="button" class="btn text-white px-4 p-2 ms-1 finalize" style="background-color:rebeccapurple" data-btn="@Model.requestid">Finalize</button>
                            <button type="reset" class="btn text-white px-4 p-2 bg-info button-info text-white" onclick="disableEditBtn()">Cancel</button>
                        </div>
                    </div>
            </form>
        </div>
    </div>
</div>

<script>
    function enbledata() {
        document.getElementById("email").disabled = false;
        document.getElementById("phone").disabled = false;
    }
    function selectAllCheckboxes() {
        var mainCheckbox = document.querySelector('#mainCheckbox');
        var checkboxes = document.querySelectorAll('.Subcheckbox');
        mainCheckbox.addEventListener('click', function () {
            checkboxes.forEach(function (checkbox) {
                checkbox.checked = mainCheckbox.checked;
            });
        });
    }
    //const input = document.querySelector("#phone");
    //const input2 = document.querySelector("#phone1");
    //const button = document.querySelector("#btn");
    //const errorMsg = document.querySelector("#error-msg");
    //const validMsg = document.querySelector("#valid-msg");
    //const errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];
    //const iti = window.intlTelInput(input, {
    //    initialCountry: "us",
    //    utilsScript: "/intl-tel-input/js/utils.js?1706723638591"
    //});
    //const iti1 = window.intlTelInput(input2, {
    //    initialCountry: "us",
    //    utilsScript: "/intl-tel-input/js/utils.js?1706723638591"
    //});
</script>
<script>
    function disableEditBtn() {
        let input = document.getElementsByClassName('input');
        for (var i = 0; i < input.length; i++) {
            input[i].disabled = true;
        }

        var editBtn = document.getElementById("edit");
        editBtn.style.display = "block";

        var saveBtn = document.getElementById("editbtnz");
        saveBtn.style.display = "none";
    }
    function EditBtn() {
        let input = document.getElementsByClassName('input');
        for (var i = 0; i < input.length; i++) {
            input[i].disabled = false;
        }

        var editBtn = document.getElementById("edit");
        editBtn.style.display = "none";

        var saveBtn = document.getElementById("editbtnz");
        saveBtn.style.display = "block";
    }

</script>
<script>
    $(document).ready(function () {
        $('.savechanges').click(function () {
            var form = $('.was-validated');
            if (form[0].checkValidity() === false) {

                event.preventDefault();
                event.stopPropagation();
            }
            form.addClass('was-validated');
        });
    });
</script>
@*<script>
    function checkInputs() {
        var inputs = document.querySelectorAll('input, select');
        var isEmpty = false;

        inputs.forEach(function (input) {
            if (!input.value.trim()) {
                isEmpty = true;
                return;
            }
        });

        var saveButtons = document.querySelectorAll('.savechanges');
        saveButtons.forEach(function (button) {
            button.disabled = isEmpty;
        });
    }
    document.addEventListener('input', checkInputs);
</script>*@
<script>
    $('.backbtn').on('click', function () {
        $("#Dashboard")[0].click();
    });

</script>
<script>
    $(document).ready(function () {
        $('#cancelButton').click(function () {
            // Reset form inputs to their default values
            $('#enable')[0].reset();
        });
    });
</script>
<script>
    $('.EncounterForm').submit(function (e) {
        e.preventDefault();
        if (!$(this).valid()) {
            return; // If the form is not valid, don't proceed
        }
        var data = new FormData(this);
        disableEditBtn();
        $.ajax({
            url: '@Url.Action("EncounterFormDataPost", "Provider")',
            type: 'Post',
            data: data,
            processData: false,
            contentType: false,
            success: function (data) {
                $(".TabContent1").html(data);
            },
            error: function () {

                console.error("Error occurred while fetching data.");
            }
        });
    });
    function finalizeForm(id) {
        Swal.fire({
            title: "Are you sure?",
            text: "Once finalized, you will not be able to make further changes.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Finalize"
        }).then((result) => {
            if (result.isConfirmed) {
                var id = @Model.encounterform.Requestid;
                console.log(id);    
                $.ajax({
                    url: "/Provider/EncounterFormFinalize",
                    type: "Post",
                    data: { Reqid: id },
                    
                    success: function (result) {
                        console.log("success");
                       
                    },
                    error: function (xhr, status, error) {
                        //toastr.error("An error occurred while finalizing the form.");
                    }
                });
            } else {
                Swal.fire("Form Finalization Cancelled", "", "info");
            }
        });
    }


</script>
<script>
    $('.finalize').click(finalizeForm);


</script>
